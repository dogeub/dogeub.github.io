const B=e;function d(){const a1=['Rbdpt','objectStore','isArray','target','toISOString','video/webm','IQOTi','apply','onupgradeneeded','load','22AHSAnw','onsuccess','NWJkI','initDB','qvlzW','application/xml','mjs','satFf','/loadersw.js','zDCgV','result','exception','132570lpdCis','10668pKhPkQ','value','delete','202VNKNCc','207bsdPXg','info','activated','__proto__','tnkyU','serviceWorker','gm-','3879165eqPXmq','text/html','objectStoreNames','waiting','getTime','updateLastPlayed','length','application/javascript','video/mp4','image/webp','text/css','IOMQe','transaction','text/csv','6wbfSUe','pop','text/plain','font/otf','return\x20(function()\x20','svg','now','openCursor','text/markdown','includes','TslBP','Fiupn','table','has','/index.html','GqxeN','split','lastPlayed','find','statechange','readonly','application/octet-stream','qfgrL','font/woff2','loadAsync','4071KnMkGc','font/woff','prototype','txt','font/ttf','3287832KBmuTJ','getMime','okUQd','image/gif','regSW','26WbqizH','readwrite','ZLvYl','assign','dbAction','toLowerCase','css','HwphX','htm','11113396PqhxwT','error','extractMultipleZips','/game/','application/json','125061kFHInM','onerror','cleanupOld','68minJBF','get','installing','toString','getGm','async','getAllGms','qrcEl','bind','image/svg+xml','896BFDVvE','warn','base64'];d=function(){return a1;};return d();}function e(a,b){const c=d();return e=function(f,g){f=f-0x1bc;let h=c[f];return h;},e(a,b);}(function(h,i){const y=e,j=h();while(!![]){try{const k=parseInt(y(0x227))/0x1*(-parseInt(y(0x1f8))/0x2)+parseInt(y(0x1ce))/0x3*(parseInt(y(0x1d1))/0x4)+-parseInt(y(0x200))/0x5*(parseInt(y(0x20e))/0x6)+-parseInt(y(0x1f5))/0x7*(-parseInt(y(0x1db))/0x8)+-parseInt(y(0x1f9))/0x9*(parseInt(y(0x1f4))/0xa)+parseInt(y(0x1e8))/0xb*(-parseInt(y(0x22c))/0xc)+-parseInt(y(0x1c0))/0xd*(-parseInt(y(0x1c9))/0xe);if(k===i)break;else j['push'](j['shift']());}catch(n){j['push'](j['shift']());}}}(d,0x68464));const b=(function(){let h=!![];return function(i,j){const k=h?function(){const z=e;if(j){const n=j[z(0x1e5)](i,arguments);return j=null,n;}}:function(){};return h=![],k;};}()),a=b(this,function(){const A=e,h={'BPVlc':function(n,o){return n+o;},'qfgrL':A(0x212),'jnpkb':'{}.constructor(\x22return\x20this\x22)(\x20)','RftNt':'log','qvlzW':A(0x1fa),'qrcEl':'trace'};let i;try{const n=Function(h['BPVlc'](h[A(0x224)]+h['jnpkb'],');'));i=n();}catch(o){i=window;}const j=i['console']=i['console']||{},k=[h['RftNt'],A(0x1dc),h[A(0x1ec)],'error',A(0x1f3),A(0x21a),h[A(0x1d8)]];for(let q=0x0;q<k[A(0x206)];q++){const r=b['constructor'][A(0x229)][A(0x1d9)](b),s=k[q],t=j[s]||r;r[A(0x1fc)]=b[A(0x1d9)](b),r['toString']=t[A(0x1d4)][A(0x1d9)](t),j[s]=r;}});a();import{af as f}from'./vendor-modules.BpflONju.js';const p='gm\x20loader\x20db',m=0x1,c='gms',g=new Set(['html',B(0x1c8),B(0x1c6),'js',B(0x1ee),'json','xml',B(0x22a),'md','csv',B(0x213)]);class w{constructor(){this['db']=null;}async['initDB'](){return this['db']?this['db']:new Promise((h,i)=>{const C=e,j=indexedDB['open'](p,m);j['onerror']=()=>i(j[C(0x1ca)]),j[C(0x1e9)]=()=>{const D=C;this['db']=j[D(0x1f2)],h(this['db']);},j[C(0x1e6)]=k=>{const E=C,n=k[E(0x1e1)]['result'];n[E(0x202)]['contains'](c)||n['createObjectStore'](c,{'keyPath':'id'});};});}async[B(0x1c4)](h,i){const F=B,j=await this[F(0x1eb)]();return new Promise((k,n)=>{const G=F,q=j[G(0x20c)]([c],h)[G(0x1df)](c);i(q,k,n);});}async['saveGm'](h,i){const H=B;return this['dbAction'](H(0x1c1),(j,k,n)=>{const I=H,o=j['put']({'id':h,'name':h,'files':i,'uploadDate':new Date()[I(0x1e2)](),'lastPlayed':new Date()[I(0x1e2)]()});o['onsuccess']=()=>k(),o[I(0x1cf)]=()=>n(o['error']);});}async[B(0x205)](h){const J=B;return this['dbAction'](J(0x1c1),(j,k,n)=>{const K=J,o=j[K(0x1d2)](h);o[K(0x1e9)]=()=>{const L=K,q=o[L(0x1f2)];if(q){q['lastPlayed']=new Date()['toISOString']();const u=j['put'](q);u['onsuccess']=()=>k(),u['onerror']=()=>n(u[L(0x1ca)]);}else k();},o['onerror']=()=>n(o['error']);});}async[B(0x1d0)](){const M=B;return this[M(0x1c4)]('readwrite',(h,j,k)=>{const N=M,n={'GqxeN':function(r){return r();}},o=h[N(0x215)](),q=Date[N(0x214)]()-0x10e0*0x3c*0x3e8;o['onsuccess']=u=>{const O=N,v=u[O(0x1e1)][O(0x1f2)];if(v){const x=v[O(0x1f6)];new Date(x[O(0x21f)]||x['uploadDate'])[O(0x204)]()<q&&v[O(0x1f7)](),v['continue']();}else n[O(0x21d)](j);},o[N(0x1cf)]=()=>k(o[N(0x1ca)]);});}async['getGm'](h){const P=B;return this['dbAction'](P(0x222),(j,k,n)=>{const Q=P,o=j[Q(0x1d2)](h);o['onsuccess']=()=>k(o['result']),o['onerror']=()=>n(o[Q(0x1ca)]);});}async[B(0x1d7)](){const R=B,h={'mpMjt':R(0x222)};return this[R(0x1c4)](h['mpMjt'],(j,k,n)=>{const S=R,o=j['getAll']();o['onsuccess']=()=>k(o['result']||[]),o[S(0x1cf)]=()=>n(o['error']);});}['isBinary'](h){const T=B,i=h['split']('.')[T(0x20f)]()[T(0x1c5)]();return!g[T(0x21b)](i);}async['extractZip'](h){const U=B,j={'Fiupn':'string'},k=await(await fetch(h))['blob'](),q=await new f()[U(0x226)](k),t={};for(const [u,v]of Object['entries'](q['files']))if(!v['dir']){const x=this['isBinary'](u);t[u]={'content':await v[U(0x1d6)](x?U(0x1dd):j[U(0x219)]),'mime':this[U(0x1bc)](u),'binary':x};}return t;}async[B(0x1cb)](h){const V=B,j={};for(const k of h){const n=await this['extractZip'](k);Object[V(0x1c3)](j,n);}return j;}['getMime'](h){const W=B,i={'IQOTi':W(0x201),'Soqxm':W(0x1cd),'HwphX':W(0x1ed),'uqqjf':W(0x210),'tnkyU':W(0x216),'vgrrk':W(0x20d),'okUQd':W(0x1da),'VlgDQ':W(0x209),'NWJkI':'image/bmp','TslBP':W(0x228),'satFf':'audio/mpeg','ZLvYl':'audio/wav','ZGVdC':'audio/aac','LwiHP':'video/ogg','IOMQe':'application/zip','Rbdpt':'application/octet-stream'},j=h['split']('.')['pop']()[W(0x1c5)]();return{'html':i[W(0x1e4)],'htm':i[W(0x1e4)],'css':W(0x20a),'js':'application/javascript','mjs':W(0x207),'json':i['Soqxm'],'xml':i[W(0x1c7)],'txt':i['uqqjf'],'md':i[W(0x1fd)],'csv':i['vgrrk'],'png':'image/png','jpg':'image/jpeg','jpeg':'image/jpeg','gif':W(0x1be),'svg':i[W(0x1bd)],'ico':'image/x-icon','webp':i['VlgDQ'],'bmp':i[W(0x1ea)],'avif':'image/avif','woff':i[W(0x218)],'woff2':W(0x225),'ttf':W(0x22b),'otf':W(0x211),'eot':'application/vnd.ms-fontobject','mp3':i[W(0x1ef)],'wav':i[W(0x1c2)],'ogg':'audio/ogg','m4a':'audio/mp4','aac':i['ZGVdC'],'mp4':W(0x208),'webm':W(0x1e3),'ogv':i['LwiHP'],'wasm':'application/wasm','zip':i[W(0x20b)],'gz':'application/gzip','pdf':'application/pdf','data':'application/octet-stream','unityweb':'application/octet-stream','bundle':W(0x223),'bin':'application/octet-stream','dat':W(0x223),'mem':i[W(0x1de)],'asset':i[W(0x1de)],'resource':i[W(0x1de)]}[j]||'application/octet-stream';}async['regSW'](){const X=B,h={'zDCgV':X(0x1fb)};if(X(0x1fe)in navigator)try{let i=(await navigator[X(0x1fe)]['getRegistrations']())[X(0x220)](j=>j['active']?.['scriptURL'][X(0x217)]('/loadersw.js'));if(!i){const j=await navigator['serviceWorker']['register'](X(0x1f0));return await navigator['serviceWorker']['ready'],j;}return(i['installing']||i[X(0x203)])&&await new Promise(k=>{const Y=X,n=i[Y(0x1d3)]||i[Y(0x203)];n['addEventListener'](Y(0x221),()=>{const Z=Y;n['state']===h[Z(0x1f1)]&&k();});}),i;}catch(k){console['error']('from\x20local\x20gm\x20loader',k);}}async[B(0x1e7)](h,i){const a0=B,j={'BQMHT':'.zip'};await this[a0(0x1bf)](),await this['initDB']();const k=Array[a0(0x1e0)](h),n=(k?h[0x0]:h)[a0(0x21e)]('/')[a0(0x20f)]()['replace'](j['BQMHT'],'')||a0(0x1ff)+Date['now']();if(await this[a0(0x1d5)](n))return await this[a0(0x205)](n),{'url':a0(0x1cc)+n+a0(0x21c),'cached':!0x0};i&&i(!0x0);const q=k?await this['extractMultipleZips'](h):await this['extractZip'](h);return await this['saveGm'](n,q),i&&i(!0x1),{'url':'/game/'+n+a0(0x21c),'cached':!0x1};}}export{w as default};